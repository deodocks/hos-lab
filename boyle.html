<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>보일의 법칙: 기체의 압력과 부피</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f5f5f5;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
  }
  .wrapper {
    background: #ffffff;
    padding: 16px 24px;
    border-radius: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    max-width: 900px;
    width: 100%;
  }
  h1 {
    margin: 0 0 4px;
    font-size: 1.25rem;
    text-align: center;
  }
  .sub {
    text-align: center;
    font-size: 0.8rem;
    color: #666;
    margin-bottom: 8px;
  }
  svg {
    width: 100%;
    display: block;
    touch-action: none; /* 터치 드래그 시 화면 스크롤 방지 */
  }
  #dragArea {
    touch-action: none;
  }
  #panel {
    margin-top: 8px;
    font-size: 0.85rem;
    display: flex;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }
  .panel-item {
    flex: 1;
    min-width: 140px;
  }
  .panel-item span.value {
    font-weight: 700;
    margin-left: 4px;
  }
  .panel-note {
    text-align: right;
    white-space: nowrap;
    font-size: 0.78rem;
  }
</style>
</head>
<body>
<div class="wrapper">
  <h1>보일의 법칙: 기체의 압력과 부피</h1>
  <p class="sub">고무패킹을 마우스로(또는 손가락으로) 눌러 드래그하여 주사기 속 공기를 압축해 보세요.</p>

  <!-- 주사기 + 압력계 그림 -->
  <svg id="scene" viewBox="0 0 900 220">
    <!-- 디지털 압력계 본체 -->
    <rect x="40" y="60" width="150" height="95" rx="18" ry="18"
          fill="#f8fcff" stroke="#cfd8e3" stroke-width="3"/>
    <!-- 디스플레이 배경 -->
    <rect x="55" y="75" width="110" height="50" rx="8" ry="8"
          fill="#e2f5ff" stroke="#9ec4dd" stroke-width="2"/>
    <!-- 디지털 숫자 + 단위 -->
    <text id="pressureText" x="110" y="105"
          text-anchor="middle" dominant-baseline="middle"
          font-family="Consolas, monospace" font-size="20" fill="#222">
      100.0 kPa
    </text>

    <!-- 본체 장식 버튼 -->
    <circle cx="135" cy="138" r="9" fill="#ffffff" stroke="#b0c0d0" stroke-width="2"/>
    <path d="M132 138 L138 138 M135 135 L135 141"
          stroke="#8aa0b5" stroke-width="1.5" stroke-linecap="round"/>

    <!-- 압력계와 주사기 연결 관 -->
    <rect x="190" y="104" width="40" height="12" rx="4" ry="4"
          fill="#d5dde5" stroke="#a6b2c0" stroke-width="2"/>

    <!-- 주사기 앞쪽 (팁) -->
    <rect x="230" y="100" width="25" height="20" rx="6" ry="6"
          fill="#f3f6fb" stroke="#a6b2c0" stroke-width="2"/>

    <!-- 주사기 실린더 외곽 -->
    <rect x="255" y="80" width="320" height="60" rx="25" ry="25"
          fill="url(#barrelGrad)" stroke="#9099a8" stroke-width="2"/>

    <!-- 눈금 -->
    <g id="scaleLines"></g>
    <g id="scaleText"></g>

    <!-- 고무패킹 -->
    <rect id="piston" x="545" y="84" width="26" height="52"
          fill="#60656f" stroke="#454b54" stroke-width="2" />

    <!-- 실린더 오른쪽 테두리 -->
    <rect x="575" y="78" width="6" height="64"
          fill="#e5e7ed" stroke="#a0a7b5" stroke-width="2"/>

    <!-- 플런저 막대(몸통) - 길이 고정 -->
    <rect id="plungerBody" x="571" y="92" width="260" height="36"
          fill="#f7f8fb" stroke="#c0c7d5" stroke-width="2"/>

    <!-- 플런저 손잡이(엄지 닿는 부분) -->
    <rect id="plungerHandle" x="831" y="80" width="22" height="60"
          fill="#f7f8fb" stroke="#c0c7d5" stroke-width="2"/>

    <!-- 넓은 드래그/터치 가능 영역 (고무패킹 + 막대 + 손잡이 전체) -->
    <rect id="dragArea" x="540" y="60" width="280" height="100"
          fill="transparent" cursor="grab"/>

    <!-- 그라디언트 -->
    <defs>
      <linearGradient id="barrelGrad" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#fdfefe"/>
        <stop offset="50%" stop-color="#f4f7fb"/>
        <stop offset="100%" stop-color="#eef2f7"/>
      </linearGradient>
    </defs>
  </svg>

  <!-- 아래 정보 패널 -->
  <div id="panel">
    <div class="panel-item">
      현재 부피 V :
      <span id="volumeDisplay" class="value">60.0</span> mL
    </div>
    <div class="panel-item">
      현재 압력 P :
      <span id="pressureDisplay" class="value">100.0</span> kPa
    </div>
    <div class="panel-item panel-note">
      온도와 기체의 양은 일정하다고 가정합니다.
    </div>
  </div>
</div>

<script>
  // 부피 범위 (mL)
  const V_MIN = 10;
  const V_MAX = 60;
  const P_AT_VMAX = 100;      // 60 mL에서 100 kPa (1기압)
  const PV_CONST = V_MAX * P_AT_VMAX; // 보일의 법칙 상수 6000

  const piston = document.getElementById("piston");
  const plungerBody = document.getElementById("plungerBody");
  const plungerHandle = document.getElementById("plungerHandle");
  const dragArea = document.getElementById("dragArea");
  const pressureText = document.getElementById("pressureText");
  const pressureDisplay = document.getElementById("pressureDisplay");
  const volumeDisplay = document.getElementById("volumeDisplay");
  const scaleLines = document.getElementById("scaleLines");
  const scaleText = document.getElementById("scaleText");
  const scene = document.getElementById("scene");

  // 플런저 x 위치 범위 (SVG 좌표)
  const MIN_X = 305;   // 10 mL
  const MAX_X = 545;   // 60 mL

  const PISTON_WIDTH = 26;
  const ROD_WIDTH = 260;  // 막대 길이 고정

  let currentX = MAX_X;
  let isDragging = false;

  function xToVolume(x) {
    const ratio = (x - MIN_X) / (MAX_X - MIN_X); // 0~1
    return V_MIN + (V_MAX - V_MIN) * ratio;
  }

  function volumeToX(V) {
    const ratio = (V - V_MIN) / (V_MAX - V_MIN);
    return MIN_X + (MAX_X - MIN_X) * ratio;
  }

  // 눈금: 1 mL마다 짧은 선, 10 mL마다 긴 선 + 숫자
  function createScale() {
    const barrelTop = 82;
    const shortLen = 8;
    const longLen = 14;
    for (let v = V_MIN; v <= V_MAX; v += 1) {
      const x = volumeToX(v);
      const isMajor10 = (v % 10 === 0);
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", x);
      line.setAttribute("x2", x);
      line.setAttribute("y1", barrelTop);
      line.setAttribute("y2", barrelTop + (isMajor10 ? longLen : shortLen));
      line.setAttribute("stroke", "#555");
      line.setAttribute("stroke-width", isMajor10 ? "1.4" : "1");
      scaleLines.appendChild(line);

      if (isMajor10) {
        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", x);
        text.setAttribute("y", barrelTop - 6);
        text.setAttribute("text-anchor", "middle");
        text.setAttribute("font-size", "10");
        text.setAttribute("fill", "#333");
        text.textContent = (v === V_MAX) ? `${v} (mL)` : `${v}`;
        scaleText.appendChild(text);
      }
    }
  }

  function updateFromX(x) {
    // clamp
    currentX = Math.max(MIN_X, Math.min(x, MAX_X));

    // 고무패킹 위치
    piston.setAttribute("x", currentX);

    // 막대(몸통)는 고정 길이로, 고무패킹 뒤에 붙어서 같이 이동
    const bodyX = currentX + PISTON_WIDTH; // 고무패킹 오른쪽 끝
    plungerBody.setAttribute("x", bodyX);
    plungerBody.setAttribute("width", ROD_WIDTH);

    // 손잡이는 막대 끝에 고정
    plungerHandle.setAttribute("x", bodyX + ROD_WIDTH);

    // 부피·압력 계산 (보일의 법칙)
    const V = xToVolume(currentX);
    const P = PV_CONST / V;

    volumeDisplay.textContent = V.toFixed(1);
    pressureDisplay.textContent = P.toFixed(1);
    pressureText.textContent = `${P.toFixed(1)} kPa`;
  }

  // ----- Pointer 이벤트 (마우스 + 터치 통합) -----
  function pointerDown(e) {
    e.preventDefault();
    isDragging = true;
    scene.setPointerCapture?.(e.pointerId);
    const rect = scene.getBoundingClientRect();
    const x = e.clientX - rect.left;
    updateFromX(x);
  }

  function pointerMove(e) {
    if (!isDragging) return;
    e.preventDefault();
    const rect = scene.getBoundingClientRect();
    const x = e.clientX - rect.left;
    updateFromX(x);
  }

  function pointerUp(e) {
    isDragging = false;
    scene.releasePointerCapture?.(e.pointerId);
  }

  [dragArea, piston, plungerBody, plungerHandle].forEach(el => {
    el.addEventListener("pointerdown", pointerDown);
  });
  window.addEventListener("pointermove", pointerMove);
  window.addEventListener("pointerup", pointerUp);
  window.addEventListener("pointercancel", pointerUp);

  // 초기 설정
  createScale();
  updateFromX(MAX_X);
</script>
</body>
</html>
